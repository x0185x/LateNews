{{ define "main" }}
<div class="container">
    <article class="listing-detail">
        <header class="listing-header">
            <div class="listing-meta">
                {{ with .Params.categories }}
                    <div class="listing-category">
                        {{ range first 1 . }}
                            <a href="{{ "/categories/" | relLangURL }}{{ . | urlize }}">{{ . }}</a>
                        {{ end }}
                    </div>
                {{ end }}
                <time class="listing-date" datetime="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}">
                    {{ .Date.Format "January 2, 2006" }}
                </time>
            </div>

            <h1 class="listing-title">{{ .Title }}</h1>

            {{ with .Params.price }}
                <div class="listing-price">{{ . }}</div>
            {{ end }}

            {{ with .Params.locations }}
                <div class="listing-location">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                        <circle cx="12" cy="10" r="3"></circle>
                    </svg>
                    {{ range first 1 . }}
                        <span>{{ . }}</span>
                    {{ end }}
                </div>
            {{ end }}
        </header>

        <div class="listing-gallery">
            {{ with .Params.images }}
                <div class="gallery-main">
                    <img src="{{ index . 0 }}" alt="{{ $.Title }}">
                </div>
                {{ if gt (len .) 1 }}
                    <div class="gallery-thumbs">
                        {{ range . }}
                            <div class="gallery-thumb">
                                <img src="{{ . }}" alt="{{ $.Title }}">
                            </div>
                        {{ end }}
                    </div>
                {{ end }}
            {{ else }}
                <div class="gallery-placeholder">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                        <circle cx="8.5" cy="8.5" r="1.5"></circle>
                        <polyline points="21 15 16 10 5 21"></polyline>
                    </svg>
                    <p>No images available</p>
                </div>
            {{ end }}
        </div>

        <div class="listing-content">
            {{ .Content }}
        </div>

        <div class="listing-details">
            <h2>Details</h2>
            <dl>
                {{ with .Params.condition }}
                    <div class="detail">
                        <dt>Condition</dt>
                        <dd>{{ . }}</dd>
                    </div>
                {{ end }}
                
                {{ with .Params.brand }}
                    <div class="detail">
                        <dt>Brand</dt>
                        <dd>{{ . }}</dd>
                    </div>
                {{ end }}
                
                {{ range $key, $value := .Params }}
                    {{ if and (ne $key "title") (ne $key "date") (ne $key "categories") (ne $key "tags") (ne $key "description") (ne $key "images") (ne $key "price") (ne $key "condition") (ne $key "brand") (ne $key "locations") }}
                        <div class="detail">
                            <dt>{{ $key | humanize }}</dt>
                            <dd>{{ $value }}</dd>
                        </div>
                    {{ end }}
                {{ end }}
            </dl>
        </div>

        <div class="listing-contact">
            <h2>Contact the seller</h2>
            <div class="contact-buttons">
                <a href="tel:{{ with .Params.phone }}{{ . }}{{ else }}+123456789{{ end }}" class="btn btn-primary">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                    </svg>
                    Call
                </a>
                <button class="btn btn-outline js-show-message-form">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                        <polyline points="22,6 12,13 2,6"></polyline>
                    </svg>
                    Message
                </button>
            </div>

            <form class="contact-form hidden">
                <div class="form-group">
                    <label for="name">Your name</label>
                    <input type="text" id="name" name="name" required>
                </div>
                <div class="form-group">
                    <label for="email">Your email</label>
                    <input type="email" id="email" name="email" required>
                </div>
                <div class="form-group">
                    <label for="message">Message</label>
                    <textarea id="message" name="message" rows="4" required></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Send Message</button>
            </form>
        </div>

        <aside class="listing-sidebar">
            <div class="seller-info">
                <h3>About the seller</h3>
                {{ with .Params.seller }}
                    <div class="seller">
                        <div class="seller-avatar">
                            {{ with .avatar }}
                                <img src="{{ . }}" alt="{{ $.Params.seller.name }}">
                            {{ else }}
                                <div class="avatar-placeholder">
                                    {{ substr (default "User" $.Params.seller.name) 0 1 }}
                                </div>
                            {{ end }}
                        </div>
                        <div class="seller-details">
                            <div class="seller-name">{{ .name }}</div>
                            <div class="seller-member-since">Member since {{ .memberSince }}</div>
                            {{ with .rating }}
                                <div class="seller-rating">
                                    {{ range $i := (seq 5) }}
                                        {{ if le $i . }}
                                            <span class="star filled">★</span>
                                        {{ else }}
                                            <span class="star">☆</span>
                                        {{ end }}
                                    {{ end }}
                                </div>
                            {{ end }}
                        </div>
                    </div>
                {{ else }}
                    <div class="seller">
                        <div class="avatar-placeholder">U</div>
                        <div class="seller-details">
                            <div class="seller-name">Unknown seller</div>
                        </div>
                    </div>
                {{ end }}
            </div>

            <div class="safety-tips">
                <h3>Safety tips</h3>
                <ul>
                    <li>Meet in a safe, public place</li>
                    <li>Don't pay in advance</li>
                    <li>Check the item before you buy</li>
                    <li>Pay only after inspecting the item</li>
                </ul>
                <a href="/safety/" class="more-tips">More safety tips</a>
            </div>

            <div class="report-listing">
                <button class="btn btn-text">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                        <line x1="12" y1="9" x2="12" y2="13"></line>
                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                    </svg>
                    Report this listing
                </button>
            </div>
        </aside>

        <div class="listing-related">
            <h2>Similar listings</h2>
            <div class="listings-grid">
                {{ $related := (where .Site.RegularPages "Type" "in" .Site.Params.mainSections) | intersect (where .Site.Pages ".Params.categories" "intersect" .Params.categories) | complement (slice .) }}
                {{ $related := $related | union (where .Site.RegularPages "Type" "in" .Site.Params.mainSections | shuffle) }}
                {{ range first 4 $related }}
                    {{ partial "listing-card.html" . }}
                {{ end }}
            </div>
        </div>
    </article>
</div>
{{ end }}
